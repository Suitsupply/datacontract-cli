{# filepath: staging_contract_sql.jinja #}
{# This template generates SQL for staging dbt models based on data contract specifications #}

{# Main configuration block with proper dbt config syntax #}
{{
    config(
        materialized = 'view',
        alias = contract.title,
        {% if contract.config_meta %}
        meta = {{ contract.config_meta }},
        {% endif %}
        {% if contract.config_tags %}
        tags = {{ contract.config_tags }},
        {% endif %}
        {% if contract.config_labels %}
        labels = {{ contract.config_labels }}
        {% endif %}
    ) 
}}

with 
_source as (
    select * from {{ ref(contract.raw_model) }}
)
select
    {% for field in contract.column_data %}
    {% if not loop.first %},{% endif %}
    cast({{ field.field_alias }}{% for i in range(28 - field.field_alias|length) %} {% endfor %} as {{ field.field_type|lower }}{% for i in range(20 - field.field_type|length - 4) %} {% endfor %}) as {{ field.field_alias }}
    {% endfor %}
from _source
